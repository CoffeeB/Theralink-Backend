generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
enum Role {
  ADMIN
  CLIENT
  STAFF
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Race {
  AFRICAN
  WHITE
  ASIAN
  HISPANIC
  OTHER
}

enum LedgerType {
  CHARGE
  PAYMENT
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum insuranceStatus {
  PRIMARY
  COPAY
}


enum eligibilityStatus {
 PENDING        
  ELIGIBLE     
  INELIGIBLE  
  UNDER_REVIEW 
  EXPIRED  
  REVOKED  
}

enum educationLevelStatus {
 ELEMENTARY        
  PRIMARY     
  HIGHSCHOOL  
  TERTIARY 
}


enum contactTypeStatus {
  TEACHERS        
  AFTER_SCHOOL     
  COMMUNITY_CENTERS  
  OTHERS
  PRINCIPAL 
  GUIDANCE_COUNSELORS
}

enum complainceStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum paymentTypeStatus {
  CASH
   CHECK
   CREDIT_CARD
   DEBIT_CARD 
}

enum treatmentGoalsStatus{
  COMPLETE
  DEFERRED
  DIS_CONTINUED
  NEW_GOAL_CREATED
  NOT_ACHIEVED
  NOT_YET_BEGUN
  ON_GOING
}

enum MessageSentStatus {
  DELIVERED
  SENT
  READ
}

enum contactedStatus {
  AUNT
  BROTHER
  CAREGIVER
  CLIENT
  COUSIN
  DAUGHTER
  FATHER
}

enum contactMethodStatus {
  EMAIL
  FAX
  IN_PERSON
  NOTES_ONLY
  PHONE
  TEXT
}

enum dischargeReasonType {
  DECLINED
  NO_IMPROVEMENT
  REFERRED_OUT
  REFUSED_TREATMENT
  SUCCESSFULL_DISCHARGE
  OTHER
}

enum SubstanceAddictionType {
  ALCOHOL
  NICOTINE
  MARIJUANA
  OPOIDS
  STIMULANTS
  HALLUCINOGENS
  INHALANTS
  SEDATIVES
  OTHER
}

enum BehaviouralAddictionType {
  GAMBLING_DISORDER
  FOOD_ADDICTION
  SEX_ADDICTION
  SHOPPING_ADDICTION
  EXCERCISE_ADDICTION
  WORK_ADDICTION
}


model User {
  id            String    @id @default(uuid())
  email         String    @unique
  username      String    @unique
  password      String
  role          Role      @default(CLIENT)
  resetToken    String?
  resetTokenExpiry DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  appointments  Appointment[] 
  conversations  ConversationParticipant[]
  sentMessages  Message[] @relation("SentMessages")   
  receivedMessages Message[] @relation("ToUserRelation") 
}

model Conversation {
  id          String                @id @default(uuid())
  lastMessage String?               // Optional, updated dynamically
  messages    Message[]             
  participants ConversationParticipant[]
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
}

model ConversationParticipant {
  conversationId String
  userId         String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  joinedAt       DateTime     @default(now())
  @@id([conversationId, userId]) 
}


model Message {
  id          String   @id @default(uuid())
  body String
  subject String?
  image String? 
  room  String?
  toUserId String
  status MessageSentStatus?

  isRead         Boolean  @default(false)  
  isImportant    Boolean  @default(false)  
  isSpam         Boolean  @default(false)  
  isDeleted      Boolean  @default(false)  

  toUser     User   @relation(fields: [toUserId], references: [id],  onDelete: Cascade, name:"ToUserRelation")
  userId   String
  user     User   @relation(fields: [userId], references: [id],  onDelete: Cascade, name:"SentMessages")
  conversationId   String
  conversation     Conversation   @relation(fields: [conversationId], references: [id],  onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Patient {
  id            String    @id @default(uuid())
  firstName     String
  lastName      String
  middleName      String?
  nickName      String?
  suffix        String?
  prefix        String?
  comments        String?
  ssn        String?
  email         String    @unique
  phone         String?
  gender        Gender
  race        Race?
  startDate     DateTime?
  dateOfBirth   DateTime
  address       Json?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  appointments  Appointment[]
  insurance     Insurance[] 
  diagnosis   Diagnosis[]
  ledger Ledger[]
  medication Medication[]
  medicationAdminstration MedicationAdminstration[]
  vitals  Vitals[]
  document Document[]
  service Service[]
  physician Physician[]
  immunization Immunization[]
  patientFile PatientFile[]
  parentContact ParentContact[]
  collateralContact CollateralContact[]
  contactNote ContactNote[]
  educationBackground EducationBackground[]
  employment Employment[]
  socialDeterminants SocialDeterminants[]
  parentSignature ParentSignature[]
  clientSignature ClientSignature[]
  complaince Compliance[]
  treatmentPlan TreatmentPlan[]
  questionnaire Questionnaire[]
  discharge Discharge[]
  medicalHistory MedicalHistory[]
  familyMedicalHistory FamilyMedicalHistory[]
}

model Appointment {
  id             String    @id @default(uuid())
  date           DateTime
  status         AppointmentStatus @default(PENDING)

  // Relationship btw patient and appointment
  patientId      String
  patient        Patient  @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  // Relationship btw appointment and doctor

  healthcareProviderId String
  healthcareProvider User @relation(fields: [healthcareProviderId], references: [id],  onDelete: Cascade)

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}


model Insurance {
  id            String     @id @default(uuid())
  insuranceType String   
  policyNumber  String     @unique
  startDate     DateTime   
  endDate       DateTime? 
  status        insuranceStatus @default(PRIMARY)
  eligibilityStatus  eligibilityStatus @default(PENDING)
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  patientId     String
  patient       Patient    @relation(fields: [patientId], references: [id],  onDelete: Cascade)
}


model Diagnosis {
  id          String    @id @default(uuid())
  patientId   String
  description String
  diagnosisCode String
  diagnosisDate DateTime @default(now())
  patient     Patient    @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Document {
  id          String   @id @default(uuid())
  template   String
  author   String
  client   String
  date   DateTime
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Ledger {
  id          String   @id @default(uuid())
  patientId   String
  description String
  paymentType paymentTypeStatus @default(CASH)
  amount      Float
  ledgerDate DateTime @default(now())
  ledgerType LedgerType
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Medication {
  id          String   @id @default(uuid())
  patientId   String
  name String
  route String
  purpose String
  prescriber String
  frequency      Float
  startDate DateTime
  endDate DateTime

  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model MedicationAdminstration {
  id          String   @id @default(uuid())

  name String
  route String
  notes String
  initials String
  frequency      Float
  administeredDate DateTime
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Vitals {
  id          String   @id @default(uuid())
  bpSys       Float
  bpDias      Float
  temperature Float
  pulseRate Float
  respiratoryRate Float
  weight Float
  height Float
  recordDate DateTime
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Service {
  id          String   @id @default(uuid())
  name        String
  description String?
  cost        Float
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}


model Physician {
  id            String    @id @default(uuid())
  firstName     String
  lastName      String
  phone         String
  address       String
  comment       String
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}



model Immunization {
  id           String   @id @default(uuid())
  patientId    String
  vaccineName  String   
  manufacturer  String   
  lotNumber  Float   
  adminstrationSite  String   
  rejectedReason  String? 
  isRejected  Boolean?   
  immunization  String?   
  dose         Int     
  dateAdministered DateTime 
  dateExpired DateTime 
  administeredBy String   
  comments        String? 
  patient      Patient  @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model PatientFile {
  id           String   @id @default(uuid())
  patientId    String
  fileName     String  
  fileType     String  
  fileUrl      String   
  description  String?  
  patient      Patient  @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


model ParentContact {
  id           String    @id @default(uuid())
  firstName     String
  lastName      String
  relationship contactedStatus   
  phone        String
  email        String?
  city      String?   
  state      String?   
  address    String?
  comments      String?   
  patientId    String
  patient      Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model CollateralContact {
  id           String    @id @default(uuid())
  firstName     String
  lastName      String
  phone        String
  email        String?
  contactType contactTypeStatus @default(OTHERS)
  patientId    String
  patient      Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model ContactNote {
  id           String    @id @default(uuid())
  staff     String
  contacted     contactedStatus
  contactDate        DateTime
  contactTime        DateTime
  contactMethod      contactMethodStatus
  note       String
  patientId    String
  patient      Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}


model EducationBackground {
  id                 String       @id @default(uuid())
  educationLevel          educationLevelStatus   @default(PRIMARY)         
  yearOfPassing  String       
  degree String         
  grade String         
  patientId          String
  patient            Patient      @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model Employment {
  id                String       @id @default(uuid())
  organizationName    String       
  designation  String       
  startDate DateTime         
  endDate DateTime         
  responsibilities String         
  patientId          String
  patient            Patient      @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model SocialDeterminants {
  id                String       @id @default(uuid())
  finance    String       
  food  String?      
  transportation String? 
  activity String?    
  patientId          String
  patient            Patient      @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model ClientSignature {
  id                String       @id @default(uuid())
  signature    String    
  pin      String 
  patientId          String
  patient            Patient      @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model ParentSignature {
  id                String       @id @default(uuid())
  signature    String    
  pin         String
  patientId          String
  patient            Patient      @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model Compliance {
  id             String    @id @default(uuid())
  startdate           DateTime
  enddate           DateTime
  lastCompleteddate           DateTime
  complaince     String
  document     String
  template     String
  service     String
  comment     String
  history     String
  completed     complainceStatus @default(PENDING)
  patientId      String
  patient        Patient  @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model TreatmentPlan {
  id          String   @id @default(uuid())
  name       String
  startDate      DateTime
  endDate      DateTime
  startTime String?
  endTime String?
  service String
  placeOfService String
  maintenanceRecommendation String?
  strength String?
  needs String?
  abilites String?
  preferences String?
  planning String?
  stepdownServices String?
  dischargePlanning String?
  agencies String?
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  treatmentGoals TreatmentGoals[]
}

model TreatmentGoals {
  id          String   @id @default(uuid())
  name       String
  startDate      DateTime?
  endDate      DateTime?
  targetDate      DateTime
  status treatmentGoalsStatus
  comments String?
  description String?
  treatmentplanId   String
  treatmentplan     TreatmentPlan   @relation(fields: [treatmentplanId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  treatmentObjective TreatmentObjective[]
}

model TreatmentObjective {
  id          String   @id @default(uuid())
  
  startDate      DateTime?
  endDate      DateTime?
  targetDate      DateTime
  objective String
  treatmentgoalsId   String
  treatmentgoals     TreatmentGoals   @relation(fields: [treatmentgoalsId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  treatmentIntervention TreatmentIntervention[]
}
model TreatmentIntervention {
  id          String   @id @default(uuid())
  intervention String
  servicetype String?
  stafftypes String?
  customstafftypes String?
  customservice String?
  frequency Float
  location String
  duration Float
  treatmentobjectiveId   String
  treatmentobjective     TreatmentObjective   @relation(fields: [treatmentobjectiveId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Questionnaire {
  id          String   @id @default(uuid())
  question String
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Discharge {
  id          String   @id @default(uuid())
  dischargeDate       String
  reason      dischargeReasonType
  linkDocument      String
  summary String?
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}


model MedicalHistory {
  id          String   @id @default(uuid())
  history       String
  addictionDetails       String
  date      DateTime
  allergies Boolean?
  sexualAbuse Boolean?
  pregnantBefore Boolean?
  expectingPregnancy Boolean?
  abortion Boolean?
  breastCancer Boolean?
  substances SubstanceAddictionType[] @default([])
  behaviours BehaviouralAddictionType[] @default([])
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}


model FamilyMedicalHistory {
  id          String   @id @default(uuid())
  familyhistory       String
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id],  onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}
